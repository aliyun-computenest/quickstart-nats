{"config":{"indexing":"full","lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"NATS\u793e\u533a\u7248\u670d\u52a1\u5b9e\u4f8b\u90e8\u7f72\u6587\u6863 \u6982\u8ff0 \u8ba1\u8d39\u8bf4\u660e \u90e8\u7f72\u67b6\u6784 \u6240\u9700\u6743\u9650 \u90e8\u7f72\u6d41\u7a0b \u53c2\u6570\u8bf4\u660e \u90e8\u7f72\u6b65\u9aa4 \u96c6\u7fa4\u914d\u7f6e\u63a2\u67e5 NATS \u96c6\u7fa4\u5b9e\u8df5 \u521b\u5efacontext \u521b\u5efa\u6d41 \u53d1\u5e03\u6d88\u606f \u521b\u5efa\u6d88\u8d39\u8005 \u6d88\u8d39\u6d88\u606f \u591a\u5b9e\u4f8b\u6d88\u8d39 \u67e5\u770b\u6d41\u72b6\u6001 \u9ad8\u53ef\u7528\u9a8c\u8bc1 \u4e0b\u4e00\u6b65 \u53c2\u8003\u6587\u6863 \u6982\u8ff0 NATS\u662f\u4e00\u4e2a\u5f00\u6e90\u3001\u8f7b\u91cf\u7ea7\u3001\u9ad8\u6027\u80fd\u7684\u5206\u5e03\u5f0f\u6d88\u606f\u4e2d\u95f4\u4ef6\u3002 \u968f\u7740NATS2.0\u7684\u51fa\u73b0\uff0cNATS\u751f\u6001\u5f97\u5230\u4e86\u6781\u5927\u7684\u53d1\u5c55\uff0cNATS 2.0\u63d0\u4f9b\u4e86\u5206\u5e03\u5f0f\u5b89\u5168\u3001\u53bb\u4e2d\u5fc3\u5316\u7ba1\u7406\u3001\u591a\u79df\u6237\u3001\u66f4\u5927\u7684\u7f51\u7edc\u3001\u5168\u7403\u53ef\u6269\u5c55\u4ee5\u53ca\u5b89\u5168\u7684\u6570\u636e\u5171\u4eab\u3002\u4f46NATS\u6d41\u5728\u9002\u5e94NATS 2.0\u65b9\u9762\u5b58\u5728\u5f88\u591a\u9650\u5236\uff0c\u800c\u4e14\u6d41\u7cfb\u7edf\u8fd8\u6ca1\u6709\u53d1\u5c55\u5230\u80fd\u591f\u5e94\u5bf9\u4e0b\u4e00\u4ee3\u7269\u8054\u7f51\u548c\u8fb9\u7f18\u8ba1\u7b97\u7684\u6311\u6218\u3002 NATS 2.0\u7684\u4e0b\u4e00\u4ee3NATS\u6d41\u7cfb\u7edf\u88ab\u79f0\u4e3aNATS JetStream\uff0c\u5177\u6709\u5206\u5e03\u5f0f\u5b89\u5168\u3001\u591a\u79df\u6237\u548c\u6c34\u5e73\u6269\u5c55\u80fd\u529b\u3002 \u8ba1\u7b97\u5de2\u4e0a\u63d0\u4f9b\u4e86NATS\u793e\u533a\u7248\u670d\u52a1\uff0c\u60a8\u65e0\u9700\u81ea\u884c\u914d\u7f6e\u4e91\u4e3b\u673a\uff0c\u5373\u53ef\u5728\u8ba1\u7b97\u5de2\u4e0a\u5feb\u901f\u90e8\u7f72NATS\u670d\u52a1\u3001\u5b9e\u73b0\u8fd0\u7ef4\u76d1\u63a7\uff0c\u4ece\u800c\u65b9\u4fbf\u5730\u57fa\u4e8eNATS\u642d\u5efa\u60a8\u81ea\u5df1\u4e91\u539f\u751f\u3001\u5206\u5e03\u5f0f\u3001\u5fae\u670d\u52a1\u67b6\u6784\u7684\u4e1a\u52a1\u5e94\u7528\u3002 \u672c\u6587\u5411\u60a8\u4ecb\u7ecd\u5982\u4f55\u5f00\u901a\u8ba1\u7b97\u5de2\u4e0a\u7684NATS\u793e\u533a\u7248\u670d\u52a1\uff0c\u4ee5\u53ca\u90e8\u7f72\u6d41\u7a0b\u548c\u4f7f\u7528\u8bf4\u660e\u3002 \u8ba1\u8d39\u8bf4\u660e NATS\u793e\u533a\u7248\u5728\u8ba1\u7b97\u5de2\u4e0a\u7684\u8d39\u7528\u4e3b\u8981\u6d89\u53ca\uff1a \u6240\u9009vCPU\u4e0e\u5185\u5b58\u89c4\u683c \u78c1\u76d8\u5bb9\u91cf \u516c\u7f51\u5e26\u5bbd(\u5982\u679c\u5f00\u542f\u516c\u7f51\u670d\u52a1) \u8ba1\u8d39\u65b9\u5f0f\u5305\u62ec\uff1a \u6309\u91cf\u4ed8\u8d39\uff08\u5c0f\u65f6\uff09 \u5305\u5e74\u5305\u6708 \u9884\u4f30\u8d39\u7528\u5728\u521b\u5efa\u5b9e\u4f8b\u65f6\u53ef\u5b9e\u65f6\u770b\u5230\u3002 \u90e8\u7f72\u67b6\u6784 NATS\u793e\u533a\u7248\u6709\u5355\u673a\u90e8\u7f72\u548c\u96c6\u7fa4\u90e8\u7f72\u4e24\u79cd\u67b6\u6784\u3002 \u96c6\u7fa4\u7248\u76ee\u524d\u53ef\u4ee5\u652f\u6301\u9009\u62e93-11\u5947\u6570\u4e2a\u8282\u70b9\u90e8\u7f72\u3002 \u6240\u9700\u6743\u9650 NATS\u670d\u52a1\u9700\u8981\u5bf9ECS\u3001VPC\u7b49\u8d44\u6e90\u8fdb\u884c\u8bbf\u95ee\u548c\u521b\u5efa\u64cd\u4f5c\uff0c\u82e5\u60a8\u4f7f\u7528RAM\u7528\u6237\u521b\u5efa\u670d\u52a1\u5b9e\u4f8b\uff0c\u9700\u8981\u5728\u521b\u5efa\u670d\u52a1\u5b9e\u4f8b\u524d\uff0c\u5bf9\u4f7f\u7528\u7684RAM\u7528\u6237\u7684\u8d26\u53f7\u6dfb\u52a0\u76f8\u5e94\u8d44\u6e90\u7684\u6743\u9650\u3002 \u6dfb\u52a0RAM\u6743\u9650\u7684\u8be6\u7ec6\u64cd\u4f5c\uff0c\u8bf7\u53c2\u89c1 \u4e3aRAM\u7528\u6237\u6388\u6743 \u3002\u6240\u9700\u6743\u9650\u5982\u4e0b\u8868\u6240\u793a\u3002 \u6743\u9650\u7b56\u7565\u540d\u79f0 \u5907\u6ce8 AliyunECSFullAccess \u7ba1\u7406\u4e91\u670d\u52a1\u5668\u670d\u52a1\uff08ECS\uff09\u7684\u6743\u9650 AliyunVPCFullAccess \u7ba1\u7406\u4e13\u6709\u7f51\u7edc\uff08VPC\uff09\u7684\u6743\u9650 AliyunROSFullAccess \u7ba1\u7406\u8d44\u6e90\u7f16\u6392\u670d\u52a1\uff08ROS\uff09\u7684\u6743\u9650 AliyunComputeNestUserFullAccess \u7ba1\u7406\u8ba1\u7b97\u5de2\u670d\u52a1\uff08ComputeNest\uff09\u7684\u7528\u6237\u4fa7\u6743\u9650 AliyunCloudMonitorFullAccess \u7ba1\u7406\u4e91\u76d1\u63a7\uff08CloudMonitor\uff09\u7684\u6743\u9650 \u90e8\u7f72\u6d41\u7a0b \u672c\u6587\u6863\u6f14\u793a\u90e8\u7f72\u96c6\u7fa4\u7248\u7684\u6d41\u7a0b\u3002 \u53c2\u6570\u8bf4\u660e \u60a8\u5728\u521b\u5efa\u670d\u52a1\u5b9e\u4f8b\u7684\u8fc7\u7a0b\u4e2d\uff0c\u9700\u8981\u914d\u7f6e\u670d\u52a1\u5b9e\u4f8b\u4fe1\u606f\u3002\u4e0b\u6587\u4ecb\u7ecdZooKeeper\u793e\u533a\u7248\u670d\u52a1\u5b9e\u4f8b\u8f93\u5165\u53c2\u6570\u7684\u8be6\u7ec6\u4fe1\u606f\u3002 \u53c2\u6570\u7ec4 \u53c2\u6570\u9879 \u793a\u4f8b \u8bf4\u660e \u9009\u62e9\u6a21\u677f \u6a21\u677f\u9009\u62e9 \u96c6\u7fa4\u7248 \u6a21\u677f\u67b6\u6784\u7c7b\u578b \u670d\u52a1\u5b9e\u4f8b\u540d\u79f0 test \u5b9e\u4f8b\u7684\u540d\u79f0 \u5730\u57df \u534e\u4e1c1\uff08\u676d\u5dde\uff09 \u9009\u4e2d\u670d\u52a1\u5b9e\u4f8b\u7684\u5730\u57df\uff0c\u5efa\u8bae\u5c31\u8fd1\u9009\u4e2d\uff0c\u4ee5\u83b7\u53d6\u66f4\u597d\u7684\u7f51\u7edc\u5ef6\u65f6\u3002 \u53ef\u7528\u533a\u914d\u7f6e \u90e8\u7f72\u533a\u57df \u53ef\u7528\u533aI \u5730\u57df\u4e0b\u7684\u4e0d\u540c\u53ef\u7528\u533a\u57df \u4ed8\u8d39\u7c7b\u578b\u914d\u7f6e \u4ed8\u8d39\u7c7b\u578b \u6309\u91cf\u4ed8\u8d39 \u6216 \u5305\u5e74\u5305\u6708 \u9009\u62e9\u5df2\u6709\u57fa\u7840\u8d44\u6e90\u914d\u7f6e VPC ID vpc-xxx \u9009\u62e9\u4e13\u6709\u7f51\u7edc\u7684ID\u3002 \u9009\u62e9\u5df2\u6709\u57fa\u7840\u8d44\u6e90\u914d\u7f6e \u4ea4\u6362\u673aID vsw-xxx \u9009\u62e9\u4ea4\u6362\u673aID\u3002\u82e5\u627e\u4e0d\u5230\u4ea4\u6362\u673a, \u53ef\u5c1d\u8bd5\u5207\u6362\u5730\u57df\u548c\u53ef\u7528\u533a ECS\u5b9e\u4f8b\u914d\u7f6e \u5b9e\u4f8b\u7c7b\u578b ecs.g7.large \u5b9e\u4f8b\u89c4\u683c\uff0c\u53ef\u4ee5\u6839\u636e\u5b9e\u9645\u9700\u6c42\u9009\u62e9 ECS\u5b9e\u4f8b\u914d\u7f6e \u7cfb\u7edf\u76d8\u7a7a\u95f4 40 \u7cfb\u7edf\u76d8\u7a7a\u95f4\uff0c\u53ef\u4ee5\u6839\u636e\u5b9e\u9645\u9700\u6c42\u9009\u62e9 ECS\u5b9e\u4f8b\u914d\u7f6e \u6570\u636e\u76d8\u7a7a\u95f4 40 \u6570\u636e\u76d8\u7a7a\u95f4\uff0c\u53ef\u4ee5\u6839\u636e\u5b9e\u9645\u9700\u6c42\u9009\u62e9 ECS\u5b9e\u4f8b\u914d\u7f6e \u5b9e\u4f8b\u5bc6\u7801 * * \u8bbe\u7f6e\u5b9e\u4f8b\u5bc6\u7801\u3002\u957f\u5ea68~30\u4e2a\u5b57\u7b26\uff0c\u5fc5\u987b\u5305\u542b\u4e09\u9879\uff08\u5927\u5199\u5b57\u6bcd\u3001\u5c0f\u5199\u5b57\u6bcd\u3001\u6570\u5b57\u3001()`~!@#$%^&*-+={}[]:;'<>,.?/ \u4e2d\u7684\u7279\u6b8a\u7b26\u53f7\uff09 ECS\u5b9e\u4f8b\u914d\u7f6e \u5f00\u542f\u516c\u7f51IP true \u662f\u5426\u5f00\u542f\u516c\u7f51IP NATS\u914d\u7f6e \u96c6\u7fa4\u8282\u70b9\u6570 3 \u96c6\u7fa4\u7248\u8282\u70b9\u6570 NATS\u914d\u7f6e admin\u5bc6\u7801 * \u9ed8\u8ba4admin\u7528\u6237\u7684\u5bc6\u780122-30\u5b57\u7b26 \u90e8\u7f72\u6b65\u9aa4 \u5355\u51fb \u90e8\u7f72\u94fe\u63a5 \uff0c \u8fdb\u5165\u670d\u52a1\u5b9e\u4f8b\u90e8\u7f72\u754c\u9762\uff0c\u6839\u636e\u754c\u9762\u63d0\u793a\uff0c\u53ef\u4ee5\u9009\u62e9\u9ed8\u8ba4\u7684\u90e8\u7f72\u6a21\u677f\uff0c\u5feb\u901f\u90e8\u7f72\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528\u81ea\u5b9a\u4e49\u6a21\u677f\uff0c\u5bf9\u4e00\u4e9b\u53c2\u6570\u8fdb\u884c\u4e2a\u6027\u5316\u914d\u7f6e\u3002 \u8be6\u7ec6\u7684\u90e8\u7f72\u9875\u9762\u5982\u4e0b\uff1a \u4fbf\u6377\u7684\u65b9\u5f0f\u662f\u9009\u62e9\u9ed8\u8ba4\u7684\u5957\u9910\uff0c\u7136\u540e\u53ea\u9700\u8981\u9009\u62e9\u53ef\u7528\u533a\u3001\u9009\u62e9VPC\u4fe1\u606f\u3001\u914d\u7f6e\u5b9e\u4f8b\u5bc6\u7801\u3001NATS\u5bc6\u7801\u70b9\u51fb\u5373\u53ef\u8fdb\u884c\u96c6\u7fa4\u521b\u5efa\u3002 \u7b49\u5f85\u5927\u7ea61\u5206\u949f\uff0c\u72b6\u6001\u53d8\u4e3a\u300c\u5df2\u90e8\u7f72\u300d\u65f6\uff0c\u96c6\u7fa4\u5373\u5b8c\u6210\u521b\u5efa\u3002 \u6b64\u65f6\u70b9\u51fb\u670d\u52a1\u5b9e\u4f8b\u540d\u79f0\u8fde\u63a5\uff0c\u8fdb\u5165\u8fde\u63a5\u9875\u9762\uff1a \u53ef\u4ee5\u770b\u5230\u516c\u7f51\u548c\u79c1\u7f51\u8bbf\u95ee\u9875\u9762\u3002 \u4e0b\u9762\u6f14\u793a\u901a\u8fc7\u516c\u7f51\u5730\u5740\u64cd\u4f5cNATS. \u96c6\u7fa4\u914d\u7f6e\u63a2\u67e5 nats \u914d\u7f6e\u6587\u4ef6 [root@iZbp139ju1kmizva7adgdbZ ~]# cat /etc/nats/nats.conf server_name=iZbp139ju1kmizva7adgdbZ-172-16-0-155 listen: 0.0.0.0:4222 http: 8222 accounts { $SYS { users = [ { user: \"admin\", pass: \"$2a$11$GUizXsS82Y.dll.uZXDic.qMDePF2IT6d3t5iWIs.rQ3lY1p6mDKC\" } ] } } jetstream { store_dir=/data/nats-storage } cluster { name: C1 listen: 0.0.0.0:4248 routes = [ nats-route://172.16.0.155:4248 nats-route://172.16.0.157:4248 nats-route://172.16.0.156:4248 ] } \u4ece\u914d\u7f6e\u53ef\u4ee5\u770b\u5230\u9ed8\u8ba4\u542f\u7528\u4e86JetStream\u7279\u6027\uff0c\u6301\u4e45\u5316\u76ee\u5f55\u5b58\u50a8\u5728\u6570\u636e\u76d8/data\u4e0b [root@iZbp19f7ptaaw66l28h5bnZ ~]# df -h Filesystem Size Used Avail Use% Mounted on devtmpfs 3.8G 0 3.8G 0% /dev tmpfs 3.8G 0 3.8G 0% /dev/shm tmpfs 3.8G 512K 3.8G 1% /run tmpfs 3.8G 0 3.8G 0% /sys/fs/cgroup /dev/vda1 40G 2.5G 35G 7% / /dev/vdb1 40G 49M 38G 1% /data tmpfs 768M 0 768M 0% /run/user/0 [root@iZbp19f7ptaaw66l28h5bnZ ~]# tree /data/nats-storage/ /data/nats-storage/ \u2514\u2500\u2500 jetstream \u251c\u2500\u2500 $G \u2502 \u2514\u2500\u2500 streams \u2502 \u2514\u2500\u2500 my_stream \u2502 \u251c\u2500\u2500 meta.inf \u2502 \u251c\u2500\u2500 meta.sum \u2502 \u251c\u2500\u2500 msgs \u2502 \u2502 \u251c\u2500\u2500 1.blk \u2502 \u2502 \u251c\u2500\u2500 1.fss \u2502 \u2502 \u2514\u2500\u2500 1.idx \u2502 \u2514\u2500\u2500 obs \u2502 \u251c\u2500\u2500 foo_comsumer \u2502 \u2502 \u251c\u2500\u2500 meta.inf \u2502 \u2502 \u251c\u2500\u2500 meta.sum \u2502 \u2502 \u2514\u2500\u2500 o.dat \u2502 \u251c\u2500\u2500 foo_consumer \u2502 \u2502 \u251c\u2500\u2500 meta.inf \u2502 \u2502 \u251c\u2500\u2500 meta.sum \u2502 \u2502 \u2514\u2500\u2500 o.dat \u2502 \u2514\u2500\u2500 foo_consumer2 \u2502 \u251c\u2500\u2500 meta.inf \u2502 \u251c\u2500\u2500 meta.sum \u2502 \u2514\u2500\u2500 o.dat nats \u4f7f\u7528systemd\u542f\u52a8\u914d\u7f6e\u5982\u4e0b\uff1a $ cat /etc/systemd/system/natsd.service [Unit] Description=natsd.service [Service] Type=simple ExecStart=/usr/bin/nats-server --config /etc/nats/nats.conf Restart=always RestartSec=10 [Install] WantedBy=multi-user.target NATS \u96c6\u7fa4\u5b9e\u8df5 \u521b\u5efacontext $ nats context save computenest-nats --server nats://47.98.102.138:4222,nats://47.98.102.138:4222,nats://47.98.102.138:4222 --description 'ComputeNest NATS Cluster' --select NATS Configuration Context \"computenest-nats\" Description: ComputeNest NATS Cluster Server URLs: nats://47.98.102.138:4222,nats://47.98.102.138:4222,nats://47.98.102.138:4222 Path: /root/.config/nats/context/computenest-nats.json Connection: OK $ nats context ls \u256d\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e \u2502 Known Contexts \u2502 \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524 \u2502 Name \u2502 Description \u2502 \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524 \u2502 computenest-nats* \u2502 ComputeNest NATS Cluster \u2502 \u2502 local \u2502 Local Host \u2502 \u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f \u63a5\u4e0b\u6765\u6240\u6709\u7684\u6b65\u9aa4\u90fd\u9ed8\u8ba4\u4f1a\u4f7f\u7528\u4e0a\u9762\u914d\u7f6e\u7684\u8ba1\u7b97\u5de2 NATS \u96c6\u7fa4. \u521b\u5efa\u6d41 $ nats stream add my_stream ? Subjects foo ? Storage file ? Replication 3 ? Retention Policy Limits ? Discard Policy Old ? Stream Messages Limit -1 ? Per Subject Messages Limit -1 ? Total Stream Size -1 ? Message TTL -1 ? Max Message Size -1 ? Duplicate tracking time window 2m0s ? Allow message Roll-ups No ? Allow message deletion Yes ? Allow purging subjects or the entire stream Yes Stream my_stream was created Information for Stream my_stream created 2023-04-09 08:28:33 Subjects: foo Replicas: 3 Storage: File Options: Retention: Limits Acknowledgements: true Discard Policy: Old Duplicate Window: 2m0s Allows Msg Delete: true Allows Purge: true Allows Rollups: false Limits: Maximum Messages: unlimited Maximum Per Subject: unlimited Maximum Bytes: unlimited Maximum Age: unlimited Maximum Message Size: unlimited Maximum Consumers: unlimited Cluster Information: Name: C1 Leader: iZbp139ju1kmizva7adgdcZ-172-16-0-157 Replica: iZbp139ju1kmizva7adgdbZ-172-16-0-155, current, seen 0.00s ago Replica: iZbp139ju1kmizva7adgddZ-172-16-0-156, current, seen 0.00s ago State: Messages: 0 Bytes: 0 B FirstSeq: 0 LastSeq: 0 Active Consumers: 0 \u6ce8\u610f\u4e8b\u9879\uff1a Replication \u914d\u7f6e\u4e3a3\uff0c\u6307\u660e\u521b\u5efa\u7684\u6d41\u5177\u5907\u4e09\u4e2a\u526f\u672c\u7684\u9ad8\u53ef\u7528\u7248\u672c\uff0cNATS \u4f1a\u57fa\u4e8eRAFT\u534f\u8bae\u8fdb\u884c\u6570\u636e\u5907\u4efd\u5b9e\u73b0\u9ad8\u53ef\u7528 \u53d1\u5e03\u6d88\u606f \u672c\u90e8\u5206\u4f7f\u7528 nats pub \u547d\u4ee4\u8fdb\u884c\u53d1\u5e03\u6d88\u606f $ nats pub foo --count=1000 --sleep 1s \"publication #{{Count}} @ {{TimeStamp}}\" 27 / 1000 [====>--------------------------------------------] 26 \u521b\u5efa\u6d88\u8d39\u8005 \u8981\u6d88\u8d39\u6d88\u606f\uff0c\u9996\u5148\u8981\u521b\u5efa\u6d88\u8d39\u8005\uff1a $ nats consumer add ? Consumer name foo_consumer ? Delivery target (empty for Pull Consumers) ? Start policy (all, new, last, subject, 1h, msg sequence) all ? Acknowledgement policy explicit ? Replay policy instant ? Filter Stream by subject (blank for all) ? Maximum Allowed Deliveries -1 ? Maximum Acknowledgements Pending 0 ? Deliver headers only without bodies No ? Add a Retry Backoff Policy No ? Select a Stream my_stream Information for Consumer my_stream > foo_consumer created 2023-04-09T08:31:23+08:00 Configuration: Durable Name: foo_consumer Pull Mode: true Deliver Policy: All Ack Policy: Explicit Ack Wait: 30s Replay Policy: Instant Max Ack Pending: 1,000 Max Waiting Pulls: 512 Cluster Information: Name: C1 Leader: iZbp139ju1kmizva7adgddZ-172-16-0-156 Replica: iZbp139ju1kmizva7adgdbZ-172-16-0-155, current, not seen Replica: iZbp139ju1kmizva7adgdcZ-172-16-0-157, current, seen 0.00s ago State: Last Delivered Message: Consumer sequence: 0 Stream sequence: 0 Acknowledgment floor: Consumer sequence: 0 Stream sequence: 0 Outstanding Acks: 0 out of maximum 1,000 Redelivered Messages: 0 Unprocessed Messages: 45 Waiting Pulls: 0 of maximum 512 \u6d88\u8d39\u6d88\u606f \u521b\u5efa\u5b8c\u6d88\u8d39\u8005\u540e\u5c31\u53ef\u4ee5\u8fdb\u884c\u6d88\u8d39\u6570\u636e\uff1a $ nats consumer next my_stream foo_consumer --count 1000 [09:05:18] subj: foo / tries: 1 / cons seq: 1 / str seq: 1 / pending: 27 publication #1 @ 2023-04-06T15:17:18+08:00 Acknowledged message [09:05:18] subj: foo / tries: 1 / cons seq: 2 / str seq: 2 / pending: 26 publication #2 @ 2023-04-06T15:17:19+08:00 Acknowledged message [09:05:18] subj: foo / tries: 1 / cons seq: 3 / str seq: 3 / pending: 25 ... \u591a\u5b9e\u4f8b\u6d88\u8d39 \u591a\u5b9e\u4f8b\u6d88\u8d39\u6f14\u793a\u591a\u4e2a\u5b9e\u4f8b\u540c\u65f6\u6d88\u8d39\u4e00\u4e2atopic\u65f6\uff0cNATS \u4f1a\u8fdb\u884c\u4e00\u5b9a\u7684\u8d1f\u8f7d\u5747\u8861\u4fdd\u8bc1\u6bcf\u4e2a\u542f\u52a8\u7684\u5b9e\u4f8b\u5747\u5206\u751f\u4ea7\u7684\u6d88\u606f\uff0c\u8fd9\u5728\u5b9e\u9645\u4e1a\u52a1\u4e2d\u53ef\u4ee5\u505a\u8d1f\u8f7d\u5747\u8861\uff0c\u6d88\u8d39\u8005\u6c34\u5e73\u6269\u5c55\u3002 \u6d88\u8d39\u5b9e\u4f8b1: $ nats consumer next my_stream foo_consumer --count 1000 ... [08:33:45] subj: foo / tries: 1 / cons seq: 186 / str seq: 186 / pending: 0 publication #186 @ 2023-04-09T08:33:45+08:00 Acknowledged message [08:33:47] subj: foo / tries: 1 / cons seq: 188 / str seq: 188 / pending: 0 publication #188 @ 2023-04-09T08:33:47+08:00 Acknowledged message [08:33:49] subj: foo / tries: 1 / cons seq: 190 / str seq: 190 / pending: 0 publication #190 @ 2023-04-09T08:33:49+08:00 Acknowledged message [08:33:51] subj: foo / tries: 1 / cons seq: 192 / str seq: 192 / pending: 0 publication #192 @ 2023-04-09T08:33:51+08:00 Acknowledged message ... \u6d88\u8d39\u5b9e\u4f8b2: $ nats consumer next my_stream foo_consumer --count 1000 [08:33:46] subj: foo / tries: 1 / cons seq: 187 / str seq: 187 / pending: 0 publication #187 @ 2023-04-09T08:33:46+08:00 Acknowledged message [08:33:48] subj: foo / tries: 1 / cons seq: 189 / str seq: 189 / pending: 0 publication #189 @ 2023-04-09T08:33:48+08:00 Acknowledged message [08:33:50] subj: foo / tries: 1 / cons seq: 191 / str seq: 191 / pending: 0 publication #191 @ 2023-04-09T08:33:50+08:00 Acknowledged message [08:33:52] subj: foo / tries: 1 / cons seq: 193 / str seq: 193 / pending: 0 publication #193 @ 2023-04-09T08:33:52+08:00 Acknowledged message \u67e5\u770b\u6d41\u72b6\u6001 $ nats stream info my_stream nats stream info my_stream Information for Stream my_stream created 2023-04-09 08:28:33 Subjects: foo Replicas: 3 Storage: File Options: Retention: Limits Acknowledgements: true Discard Policy: Old Duplicate Window: 2m0s Allows Msg Delete: true Allows Purge: true Allows Rollups: false Limits: Maximum Messages: unlimited Maximum Per Subject: unlimited Maximum Bytes: unlimited Maximum Age: unlimited Maximum Message Size: unlimited Maximum Consumers: unlimited Cluster Information: Name: C1 Leader: iZbp139ju1kmizva7adgdcZ-172-16-0-157 Replica: iZbp139ju1kmizva7adgdbZ-172-16-0-155, current, seen 0.85s ago Replica: iZbp139ju1kmizva7adgddZ-172-16-0-156, current, seen 0.85s ago State: Messages: 350 Bytes: 26 KiB FirstSeq: 1 @ 2023-04-09T00:30:38 UTC LastSeq: 350 @ 2023-04-09T00:36:30 UTC Active Consumers: 1 Number of Subjects: 1 \u8bf4\u660e\uff1a \u53ef\u4ee5\u770b\u5230\u6d41\u7684\u526f\u672c\u6570\u4e3a3 \u96c6\u7fa4\u4fe1\u606f\u90e8\u5206\u53ef\u4ee5\u770b\u5230node2-c1 \u8fd9\u4e2a\u8282\u70b9\u662fLeader\uff0cnode1\u3001node3\u662fFollower \u4e0b\u4e00\u6b65\u5c06node2\u8282\u70b9\u5b95\u673a\u89c2\u770b\u6d41\u7684\u60c5\u51b5\u3002 \u9ad8\u53ef\u7528\u9a8c\u8bc1 \u901a\u8fc7\u67e5\u770b\u6d41\u7684\u72b6\u6001\u53d1\u73b0\u521b\u5efa\u7684\u6d41\u7684leader\u8282\u70b9\u662f\"iZbp139ju1kmizva7adgdcZ-172-16-0-157\"\uff0c \u73b0\u5728\u5c06\u6b64\u8282\u70b9\u5173\u673a: \u4e4b\u540e\u518d\u67e5\u770b\u6d41\u7684\u72b6\u6001 $ nats stream info my_stream Information for Stream my_stream created 2023-04-09 08:28:33 Subjects: foo Replicas: 3 Storage: File Options: Retention: Limits Acknowledgements: true Discard Policy: Old Duplicate Window: 2m0s Allows Msg Delete: true Allows Purge: true Allows Rollups: false Limits: Maximum Messages: unlimited Maximum Per Subject: unlimited Maximum Bytes: unlimited Maximum Age: unlimited Maximum Message Size: unlimited Maximum Consumers: unlimited Cluster Information: Name: C1 Leader: iZbp139ju1kmizva7adgddZ-172-16-0-156 Replica: iZbp139ju1kmizva7adgdbZ-172-16-0-155, current, seen 0.38s ago Replica: iZbp139ju1kmizva7adgdcZ-172-16-0-157, outdated, OFFLINE, seen 20.64s ago, 548 operations behind State: Messages: 545 Bytes: 41 KiB FirstSeq: 1 @ 2023-04-09T00:30:38 UTC LastSeq: 545 @ 2023-04-09T00:39:46 UTC Active Consumers: 1 Number of Subjects: 1 \u53ef\u4ee5\u770b\u5230\u96c6\u7fa4\u72b6\u6001\u90e8\u5206 156\u53f7\u8282\u70b9\u53d8\u6210\u65b0\u7684Leader\uff0c157\u72b6\u6001\u4e3aOFFLINE\u3002 \u6b64\u65f6\u521b\u5efa\u65b0\u7684\u6d88\u8d39\u8005\u91cd\u65b0\u6d88\u8d39\u6570\u636e\uff1a nats consumer add ? Consumer name foo_consumer2 ? Delivery target (empty for Pull Consumers) ? Start policy (all, new, last, subject, 1h, msg sequence) all ? Acknowledgement policy explicit ? Replay policy instant ? Filter Stream by subject (blank for all) ? Maximum Allowed Deliveries -1 ? Maximum Acknowledgements Pending 0 ? Deliver headers only without bodies No ? Add a Retry Backoff Policy No ? Select a Stream my_stream Information for Consumer my_stream > foo_consumer2 created 2023-04-09T08:42:07+08:00 Configuration: Durable Name: foo_consumer2 Pull Mode: true Deliver Policy: All Ack Policy: Explicit Ack Wait: 30s Replay Policy: Instant Max Ack Pending: 1,000 Max Waiting Pulls: 512 Cluster Information: Name: C1 Leader: iZbp139ju1kmizva7adgdbZ-172-16-0-155 Replica: iZbp139ju1kmizva7adgdcZ-172-16-0-157, outdated, not seen Replica: iZbp139ju1kmizva7adgddZ-172-16-0-156, current, seen 0.00s ago State: Last Delivered Message: Consumer sequence: 0 Stream sequence: 0 Acknowledgment floor: Consumer sequence: 0 Stream sequence: 0 Outstanding Acks: 0 out of maximum 1,000 Redelivered Messages: 0 Unprocessed Messages: 685 Waiting Pulls: 0 of maximum 512 $ nats consumer next my_stream foo_consumer2 --count 3 [08:42:27] subj: foo / tries: 1 / cons seq: 1 / str seq: 1 / pending: 703 publication #1 @ 2023-04-09T08:30:38+08:00 Acknowledged message [08:42:27] subj: foo / tries: 1 / cons seq: 2 / str seq: 2 / pending: 702 publication #2 @ 2023-04-09T08:30:39+08:00 Acknowledged message [08:42:27] subj: foo / tries: 1 / cons seq: 3 / str seq: 3 / pending: 701 publication #3 @ 2023-04-09T08:30:40+08:00 Acknowledged message \u6b64\u65f6\u6545\u969c\u8282\u70b9\u6062\u590d\u4e4b\u540e\uff1a\u91cd\u65b0\u67e5\u770b\u6d41\u7684\u72b6\u6001\uff1a $ nats stream info my_stream Information for Stream my_stream created 2023-04-09 08:28:33 Subjects: foo Replicas: 3 Storage: File Options: Retention: Limits Acknowledgements: true Discard Policy: Old Duplicate Window: 2m0s Allows Msg Delete: true Allows Purge: true Allows Rollups: false Limits: Maximum Messages: unlimited Maximum Per Subject: unlimited Maximum Bytes: unlimited Maximum Age: unlimited Maximum Message Size: unlimited Maximum Consumers: unlimited Cluster Information: Name: C1 Leader: iZbp139ju1kmizva7adgddZ-172-16-0-156 Replica: iZbp139ju1kmizva7adgdbZ-172-16-0-155, current, seen 0.22s ago Replica: iZbp139ju1kmizva7adgdcZ-172-16-0-157, current, seen 0.22s ago State: Messages: 780 Bytes: 58 KiB FirstSeq: 1 @ 2023-04-09T00:30:38 UTC LastSeq: 780 @ 2023-04-09T00:43:43 UTC Active Consumers: 2 Number of Subjects: 1 \u53ef\u4ee5\u770b\u5230\u6d41\u7684\u96c6\u7fa4\u4fe1\u606f\u4e09\u4e2a\u8282\u70b9\u5168\u90e8\u53d8\u4e3a\u53ef\u7528\u72b6\u6001\uff0c\u521a\u5f02\u5e38\u7684node2\u8282\u70b9\u6062\u590d\u4e86,\u52a0\u5165\u4e4b\u524d\u4e24\u4e2a\u5065\u5eb7\u8282\u70b9\u7684\u96c6\u7fa4\u540e\u81ea\u52a8\u53d8\u6210\u4e86follower\u3002 \u4e0b\u4e00\u6b65 NATS \u76ee\u524d\u9010\u6b65\u6f14\u53d8\u4e3a\u4e00\u4e2a\u751f\u6001\uff0c\u53ef\u4ee5\u5b9e\u8df5\u3001\u6f14\u793a\u7684\u529f\u80fd\u8fd8\u975e\u5e38\u591a\uff0c\u5305\u62ec\u5355\u4e0d\u9650\u4e8e\u4ee5\u4e0b\u65b9\u9762\uff1a \u5b89\u5168\u8ba4\u8bc1 \uff1a\u652f\u6301Token\u3001user/pass\u3001TLS\u3001NKEY\u3001JWT\u7b49\u5b89\u5168\u914d\u7f6e \u8fde\u63a5\u534f\u8bae \uff1a\u9664\u4e86\u57fa\u4e8e\u9ed8\u8ba4\u7684nats \u8fde\u63a5\u534f\u8bae\u5916\uff0c\u8fd8\u652f\u6301WebSocket\u3001MQTT\u8fde\u63a5\uff0c\u5e76\u4e14\u53ef\u4ee5\u901a\u8fc7Kafka Bridge JMS \u5c06\u5176\u4ed6\u6d88\u606f\u7cfb\u7edf\u7684\u6d41\u91cf\u8f6c\u5230NATS JetStream \u66f4\u591a\u7684\u529f\u80fd \uff1aJetStream \u662fNATS\u6700\u65b0\u4e00\u4ee3\u7684\u9ad8\u53ef\u7528\u6d41\u5f0f\u7cfb\u7edf\uff0c\u652f\u6301\u975e\u5e38\u591a\u7684\u9ad8\u7ea7\u7279\u6027\uff1a \u6d41\u91cd\u653e\u7b56\u7565 \u6d41\u5f0f\u5b58\u50a8 \u4fdd\u7559\u7b56\u7565 \u6d88\u606f\u914d\u989d \u6301\u4e45\u5316 \u6d41Mirror \u53cc\u7aef\u6d41\u63a7 Exactly-Once\u8bed\u4e49\u652f\u6301 \u591a\u79df\u6237\u7ba1\u7406 \uff1a\u57fa\u4e8e nsc \u5de5\u5177\u8fdb\u884c\u591a\u79df\u6237\u8d26\u53f7\u914d\u7f6e\u7ba1\u7406 \u8fb9\u7f18\u573a\u666f \uff1a\u4e3a\u4e86\u652f\u6301\u8fb9\u7f18\u8ba1\u7b97\u3001IOT\u573a\u666f\uff0cNATS\u652f\u6301\u5728\u8fb9\u7f18\u90e8\u7f72\u672c\u5730\u7684NATS\u96c6\u7fa4\uff0c\u8ddf\u4e2d\u5fc3\u96c6\u7fa4\u4ea4\u4e92\u3002\u4f7f\u5f97\u8fb9\u7f18\u8bbe\u5907\u53ef\u4ee5\u901a\u8fc7\u8fde\u63a5\u8fb9\u7f18\u672c\u5730\u96c6\u7fa4\u5feb\u901f\u8fdb\u884c\u4e1a\u52a1\u6570\u636e\u7684\u751f\u4ea7\uff0c\u4e0d\u4f1a\u5f3a\u4f9d\u8d56\u8ddf\u8fdc\u7aef\u4e2d\u5fc3\u96c6\u7fa4\u7684\u7f51\u7edc\u7a33\u5b9a\u6027\uff0c\u8fb9\u7f18\u573a\u666f \u53c2\u8003 \u3002 \u53c2\u8003\u6587\u6863 [1]: nats cluster creation: https://docs.nats.io/running-a-nats-service/nats_docker#creating-a-nats-cluster [2]: jetString cluster: https://docs.nats.io/running-a-nats-service/configuration/clustering/jetstream_clustering [3]: js walkthrough\uff1a https://docs.nats.io/nats-concepts/jetstream/js_walkthrough [4]: \u57fa\u4e8eNATS JetStream\u6784\u5efa\u5206\u5e03\u5f0f\u4e8b\u4ef6\u6d41\u7cfb\u7edf","title":"NATS\u793e\u533a\u7248\u670d\u52a1\u5b9e\u4f8b\u90e8\u7f72\u6587\u6863"},{"location":"#nats","text":"\u6982\u8ff0 \u8ba1\u8d39\u8bf4\u660e \u90e8\u7f72\u67b6\u6784 \u6240\u9700\u6743\u9650 \u90e8\u7f72\u6d41\u7a0b \u53c2\u6570\u8bf4\u660e \u90e8\u7f72\u6b65\u9aa4 \u96c6\u7fa4\u914d\u7f6e\u63a2\u67e5 NATS \u96c6\u7fa4\u5b9e\u8df5 \u521b\u5efacontext \u521b\u5efa\u6d41 \u53d1\u5e03\u6d88\u606f \u521b\u5efa\u6d88\u8d39\u8005 \u6d88\u8d39\u6d88\u606f \u591a\u5b9e\u4f8b\u6d88\u8d39 \u67e5\u770b\u6d41\u72b6\u6001 \u9ad8\u53ef\u7528\u9a8c\u8bc1 \u4e0b\u4e00\u6b65 \u53c2\u8003\u6587\u6863","title":"NATS\u793e\u533a\u7248\u670d\u52a1\u5b9e\u4f8b\u90e8\u7f72\u6587\u6863"},{"location":"#_1","text":"NATS\u662f\u4e00\u4e2a\u5f00\u6e90\u3001\u8f7b\u91cf\u7ea7\u3001\u9ad8\u6027\u80fd\u7684\u5206\u5e03\u5f0f\u6d88\u606f\u4e2d\u95f4\u4ef6\u3002 \u968f\u7740NATS2.0\u7684\u51fa\u73b0\uff0cNATS\u751f\u6001\u5f97\u5230\u4e86\u6781\u5927\u7684\u53d1\u5c55\uff0cNATS 2.0\u63d0\u4f9b\u4e86\u5206\u5e03\u5f0f\u5b89\u5168\u3001\u53bb\u4e2d\u5fc3\u5316\u7ba1\u7406\u3001\u591a\u79df\u6237\u3001\u66f4\u5927\u7684\u7f51\u7edc\u3001\u5168\u7403\u53ef\u6269\u5c55\u4ee5\u53ca\u5b89\u5168\u7684\u6570\u636e\u5171\u4eab\u3002\u4f46NATS\u6d41\u5728\u9002\u5e94NATS 2.0\u65b9\u9762\u5b58\u5728\u5f88\u591a\u9650\u5236\uff0c\u800c\u4e14\u6d41\u7cfb\u7edf\u8fd8\u6ca1\u6709\u53d1\u5c55\u5230\u80fd\u591f\u5e94\u5bf9\u4e0b\u4e00\u4ee3\u7269\u8054\u7f51\u548c\u8fb9\u7f18\u8ba1\u7b97\u7684\u6311\u6218\u3002 NATS 2.0\u7684\u4e0b\u4e00\u4ee3NATS\u6d41\u7cfb\u7edf\u88ab\u79f0\u4e3aNATS JetStream\uff0c\u5177\u6709\u5206\u5e03\u5f0f\u5b89\u5168\u3001\u591a\u79df\u6237\u548c\u6c34\u5e73\u6269\u5c55\u80fd\u529b\u3002 \u8ba1\u7b97\u5de2\u4e0a\u63d0\u4f9b\u4e86NATS\u793e\u533a\u7248\u670d\u52a1\uff0c\u60a8\u65e0\u9700\u81ea\u884c\u914d\u7f6e\u4e91\u4e3b\u673a\uff0c\u5373\u53ef\u5728\u8ba1\u7b97\u5de2\u4e0a\u5feb\u901f\u90e8\u7f72NATS\u670d\u52a1\u3001\u5b9e\u73b0\u8fd0\u7ef4\u76d1\u63a7\uff0c\u4ece\u800c\u65b9\u4fbf\u5730\u57fa\u4e8eNATS\u642d\u5efa\u60a8\u81ea\u5df1\u4e91\u539f\u751f\u3001\u5206\u5e03\u5f0f\u3001\u5fae\u670d\u52a1\u67b6\u6784\u7684\u4e1a\u52a1\u5e94\u7528\u3002 \u672c\u6587\u5411\u60a8\u4ecb\u7ecd\u5982\u4f55\u5f00\u901a\u8ba1\u7b97\u5de2\u4e0a\u7684NATS\u793e\u533a\u7248\u670d\u52a1\uff0c\u4ee5\u53ca\u90e8\u7f72\u6d41\u7a0b\u548c\u4f7f\u7528\u8bf4\u660e\u3002","title":"\u6982\u8ff0"},{"location":"#_2","text":"NATS\u793e\u533a\u7248\u5728\u8ba1\u7b97\u5de2\u4e0a\u7684\u8d39\u7528\u4e3b\u8981\u6d89\u53ca\uff1a \u6240\u9009vCPU\u4e0e\u5185\u5b58\u89c4\u683c \u78c1\u76d8\u5bb9\u91cf \u516c\u7f51\u5e26\u5bbd(\u5982\u679c\u5f00\u542f\u516c\u7f51\u670d\u52a1) \u8ba1\u8d39\u65b9\u5f0f\u5305\u62ec\uff1a \u6309\u91cf\u4ed8\u8d39\uff08\u5c0f\u65f6\uff09 \u5305\u5e74\u5305\u6708 \u9884\u4f30\u8d39\u7528\u5728\u521b\u5efa\u5b9e\u4f8b\u65f6\u53ef\u5b9e\u65f6\u770b\u5230\u3002","title":"\u8ba1\u8d39\u8bf4\u660e"},{"location":"#_3","text":"NATS\u793e\u533a\u7248\u6709\u5355\u673a\u90e8\u7f72\u548c\u96c6\u7fa4\u90e8\u7f72\u4e24\u79cd\u67b6\u6784\u3002 \u96c6\u7fa4\u7248\u76ee\u524d\u53ef\u4ee5\u652f\u6301\u9009\u62e93-11\u5947\u6570\u4e2a\u8282\u70b9\u90e8\u7f72\u3002","title":"\u90e8\u7f72\u67b6\u6784"},{"location":"#_4","text":"NATS\u670d\u52a1\u9700\u8981\u5bf9ECS\u3001VPC\u7b49\u8d44\u6e90\u8fdb\u884c\u8bbf\u95ee\u548c\u521b\u5efa\u64cd\u4f5c\uff0c\u82e5\u60a8\u4f7f\u7528RAM\u7528\u6237\u521b\u5efa\u670d\u52a1\u5b9e\u4f8b\uff0c\u9700\u8981\u5728\u521b\u5efa\u670d\u52a1\u5b9e\u4f8b\u524d\uff0c\u5bf9\u4f7f\u7528\u7684RAM\u7528\u6237\u7684\u8d26\u53f7\u6dfb\u52a0\u76f8\u5e94\u8d44\u6e90\u7684\u6743\u9650\u3002 \u6dfb\u52a0RAM\u6743\u9650\u7684\u8be6\u7ec6\u64cd\u4f5c\uff0c\u8bf7\u53c2\u89c1 \u4e3aRAM\u7528\u6237\u6388\u6743 \u3002\u6240\u9700\u6743\u9650\u5982\u4e0b\u8868\u6240\u793a\u3002 \u6743\u9650\u7b56\u7565\u540d\u79f0 \u5907\u6ce8 AliyunECSFullAccess \u7ba1\u7406\u4e91\u670d\u52a1\u5668\u670d\u52a1\uff08ECS\uff09\u7684\u6743\u9650 AliyunVPCFullAccess \u7ba1\u7406\u4e13\u6709\u7f51\u7edc\uff08VPC\uff09\u7684\u6743\u9650 AliyunROSFullAccess \u7ba1\u7406\u8d44\u6e90\u7f16\u6392\u670d\u52a1\uff08ROS\uff09\u7684\u6743\u9650 AliyunComputeNestUserFullAccess \u7ba1\u7406\u8ba1\u7b97\u5de2\u670d\u52a1\uff08ComputeNest\uff09\u7684\u7528\u6237\u4fa7\u6743\u9650 AliyunCloudMonitorFullAccess \u7ba1\u7406\u4e91\u76d1\u63a7\uff08CloudMonitor\uff09\u7684\u6743\u9650","title":"\u6240\u9700\u6743\u9650"},{"location":"#_5","text":"\u672c\u6587\u6863\u6f14\u793a\u90e8\u7f72\u96c6\u7fa4\u7248\u7684\u6d41\u7a0b\u3002","title":"\u90e8\u7f72\u6d41\u7a0b"},{"location":"#_6","text":"\u60a8\u5728\u521b\u5efa\u670d\u52a1\u5b9e\u4f8b\u7684\u8fc7\u7a0b\u4e2d\uff0c\u9700\u8981\u914d\u7f6e\u670d\u52a1\u5b9e\u4f8b\u4fe1\u606f\u3002\u4e0b\u6587\u4ecb\u7ecdZooKeeper\u793e\u533a\u7248\u670d\u52a1\u5b9e\u4f8b\u8f93\u5165\u53c2\u6570\u7684\u8be6\u7ec6\u4fe1\u606f\u3002 \u53c2\u6570\u7ec4 \u53c2\u6570\u9879 \u793a\u4f8b \u8bf4\u660e \u9009\u62e9\u6a21\u677f \u6a21\u677f\u9009\u62e9 \u96c6\u7fa4\u7248 \u6a21\u677f\u67b6\u6784\u7c7b\u578b \u670d\u52a1\u5b9e\u4f8b\u540d\u79f0 test \u5b9e\u4f8b\u7684\u540d\u79f0 \u5730\u57df \u534e\u4e1c1\uff08\u676d\u5dde\uff09 \u9009\u4e2d\u670d\u52a1\u5b9e\u4f8b\u7684\u5730\u57df\uff0c\u5efa\u8bae\u5c31\u8fd1\u9009\u4e2d\uff0c\u4ee5\u83b7\u53d6\u66f4\u597d\u7684\u7f51\u7edc\u5ef6\u65f6\u3002 \u53ef\u7528\u533a\u914d\u7f6e \u90e8\u7f72\u533a\u57df \u53ef\u7528\u533aI \u5730\u57df\u4e0b\u7684\u4e0d\u540c\u53ef\u7528\u533a\u57df \u4ed8\u8d39\u7c7b\u578b\u914d\u7f6e \u4ed8\u8d39\u7c7b\u578b \u6309\u91cf\u4ed8\u8d39 \u6216 \u5305\u5e74\u5305\u6708 \u9009\u62e9\u5df2\u6709\u57fa\u7840\u8d44\u6e90\u914d\u7f6e VPC ID vpc-xxx \u9009\u62e9\u4e13\u6709\u7f51\u7edc\u7684ID\u3002 \u9009\u62e9\u5df2\u6709\u57fa\u7840\u8d44\u6e90\u914d\u7f6e \u4ea4\u6362\u673aID vsw-xxx \u9009\u62e9\u4ea4\u6362\u673aID\u3002\u82e5\u627e\u4e0d\u5230\u4ea4\u6362\u673a, \u53ef\u5c1d\u8bd5\u5207\u6362\u5730\u57df\u548c\u53ef\u7528\u533a ECS\u5b9e\u4f8b\u914d\u7f6e \u5b9e\u4f8b\u7c7b\u578b ecs.g7.large \u5b9e\u4f8b\u89c4\u683c\uff0c\u53ef\u4ee5\u6839\u636e\u5b9e\u9645\u9700\u6c42\u9009\u62e9 ECS\u5b9e\u4f8b\u914d\u7f6e \u7cfb\u7edf\u76d8\u7a7a\u95f4 40 \u7cfb\u7edf\u76d8\u7a7a\u95f4\uff0c\u53ef\u4ee5\u6839\u636e\u5b9e\u9645\u9700\u6c42\u9009\u62e9 ECS\u5b9e\u4f8b\u914d\u7f6e \u6570\u636e\u76d8\u7a7a\u95f4 40 \u6570\u636e\u76d8\u7a7a\u95f4\uff0c\u53ef\u4ee5\u6839\u636e\u5b9e\u9645\u9700\u6c42\u9009\u62e9 ECS\u5b9e\u4f8b\u914d\u7f6e \u5b9e\u4f8b\u5bc6\u7801 * * \u8bbe\u7f6e\u5b9e\u4f8b\u5bc6\u7801\u3002\u957f\u5ea68~30\u4e2a\u5b57\u7b26\uff0c\u5fc5\u987b\u5305\u542b\u4e09\u9879\uff08\u5927\u5199\u5b57\u6bcd\u3001\u5c0f\u5199\u5b57\u6bcd\u3001\u6570\u5b57\u3001()`~!@#$%^&*-+={}[]:;'<>,.?/ \u4e2d\u7684\u7279\u6b8a\u7b26\u53f7\uff09 ECS\u5b9e\u4f8b\u914d\u7f6e \u5f00\u542f\u516c\u7f51IP true \u662f\u5426\u5f00\u542f\u516c\u7f51IP NATS\u914d\u7f6e \u96c6\u7fa4\u8282\u70b9\u6570 3 \u96c6\u7fa4\u7248\u8282\u70b9\u6570 NATS\u914d\u7f6e admin\u5bc6\u7801 * \u9ed8\u8ba4admin\u7528\u6237\u7684\u5bc6\u780122-30\u5b57\u7b26","title":"\u53c2\u6570\u8bf4\u660e"},{"location":"#_7","text":"\u5355\u51fb \u90e8\u7f72\u94fe\u63a5 \uff0c \u8fdb\u5165\u670d\u52a1\u5b9e\u4f8b\u90e8\u7f72\u754c\u9762\uff0c\u6839\u636e\u754c\u9762\u63d0\u793a\uff0c\u53ef\u4ee5\u9009\u62e9\u9ed8\u8ba4\u7684\u90e8\u7f72\u6a21\u677f\uff0c\u5feb\u901f\u90e8\u7f72\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528\u81ea\u5b9a\u4e49\u6a21\u677f\uff0c\u5bf9\u4e00\u4e9b\u53c2\u6570\u8fdb\u884c\u4e2a\u6027\u5316\u914d\u7f6e\u3002 \u8be6\u7ec6\u7684\u90e8\u7f72\u9875\u9762\u5982\u4e0b\uff1a \u4fbf\u6377\u7684\u65b9\u5f0f\u662f\u9009\u62e9\u9ed8\u8ba4\u7684\u5957\u9910\uff0c\u7136\u540e\u53ea\u9700\u8981\u9009\u62e9\u53ef\u7528\u533a\u3001\u9009\u62e9VPC\u4fe1\u606f\u3001\u914d\u7f6e\u5b9e\u4f8b\u5bc6\u7801\u3001NATS\u5bc6\u7801\u70b9\u51fb\u5373\u53ef\u8fdb\u884c\u96c6\u7fa4\u521b\u5efa\u3002 \u7b49\u5f85\u5927\u7ea61\u5206\u949f\uff0c\u72b6\u6001\u53d8\u4e3a\u300c\u5df2\u90e8\u7f72\u300d\u65f6\uff0c\u96c6\u7fa4\u5373\u5b8c\u6210\u521b\u5efa\u3002 \u6b64\u65f6\u70b9\u51fb\u670d\u52a1\u5b9e\u4f8b\u540d\u79f0\u8fde\u63a5\uff0c\u8fdb\u5165\u8fde\u63a5\u9875\u9762\uff1a \u53ef\u4ee5\u770b\u5230\u516c\u7f51\u548c\u79c1\u7f51\u8bbf\u95ee\u9875\u9762\u3002 \u4e0b\u9762\u6f14\u793a\u901a\u8fc7\u516c\u7f51\u5730\u5740\u64cd\u4f5cNATS.","title":"\u90e8\u7f72\u6b65\u9aa4"},{"location":"#_8","text":"nats \u914d\u7f6e\u6587\u4ef6 [root@iZbp139ju1kmizva7adgdbZ ~]# cat /etc/nats/nats.conf server_name=iZbp139ju1kmizva7adgdbZ-172-16-0-155 listen: 0.0.0.0:4222 http: 8222 accounts { $SYS { users = [ { user: \"admin\", pass: \"$2a$11$GUizXsS82Y.dll.uZXDic.qMDePF2IT6d3t5iWIs.rQ3lY1p6mDKC\" } ] } } jetstream { store_dir=/data/nats-storage } cluster { name: C1 listen: 0.0.0.0:4248 routes = [ nats-route://172.16.0.155:4248 nats-route://172.16.0.157:4248 nats-route://172.16.0.156:4248 ] } \u4ece\u914d\u7f6e\u53ef\u4ee5\u770b\u5230\u9ed8\u8ba4\u542f\u7528\u4e86JetStream\u7279\u6027\uff0c\u6301\u4e45\u5316\u76ee\u5f55\u5b58\u50a8\u5728\u6570\u636e\u76d8/data\u4e0b [root@iZbp19f7ptaaw66l28h5bnZ ~]# df -h Filesystem Size Used Avail Use% Mounted on devtmpfs 3.8G 0 3.8G 0% /dev tmpfs 3.8G 0 3.8G 0% /dev/shm tmpfs 3.8G 512K 3.8G 1% /run tmpfs 3.8G 0 3.8G 0% /sys/fs/cgroup /dev/vda1 40G 2.5G 35G 7% / /dev/vdb1 40G 49M 38G 1% /data tmpfs 768M 0 768M 0% /run/user/0 [root@iZbp19f7ptaaw66l28h5bnZ ~]# tree /data/nats-storage/ /data/nats-storage/ \u2514\u2500\u2500 jetstream \u251c\u2500\u2500 $G \u2502 \u2514\u2500\u2500 streams \u2502 \u2514\u2500\u2500 my_stream \u2502 \u251c\u2500\u2500 meta.inf \u2502 \u251c\u2500\u2500 meta.sum \u2502 \u251c\u2500\u2500 msgs \u2502 \u2502 \u251c\u2500\u2500 1.blk \u2502 \u2502 \u251c\u2500\u2500 1.fss \u2502 \u2502 \u2514\u2500\u2500 1.idx \u2502 \u2514\u2500\u2500 obs \u2502 \u251c\u2500\u2500 foo_comsumer \u2502 \u2502 \u251c\u2500\u2500 meta.inf \u2502 \u2502 \u251c\u2500\u2500 meta.sum \u2502 \u2502 \u2514\u2500\u2500 o.dat \u2502 \u251c\u2500\u2500 foo_consumer \u2502 \u2502 \u251c\u2500\u2500 meta.inf \u2502 \u2502 \u251c\u2500\u2500 meta.sum \u2502 \u2502 \u2514\u2500\u2500 o.dat \u2502 \u2514\u2500\u2500 foo_consumer2 \u2502 \u251c\u2500\u2500 meta.inf \u2502 \u251c\u2500\u2500 meta.sum \u2502 \u2514\u2500\u2500 o.dat nats \u4f7f\u7528systemd\u542f\u52a8\u914d\u7f6e\u5982\u4e0b\uff1a $ cat /etc/systemd/system/natsd.service [Unit] Description=natsd.service [Service] Type=simple ExecStart=/usr/bin/nats-server --config /etc/nats/nats.conf Restart=always RestartSec=10 [Install] WantedBy=multi-user.target","title":"\u96c6\u7fa4\u914d\u7f6e\u63a2\u67e5"},{"location":"#nats_1","text":"","title":"NATS \u96c6\u7fa4\u5b9e\u8df5"},{"location":"#context","text":"$ nats context save computenest-nats --server nats://47.98.102.138:4222,nats://47.98.102.138:4222,nats://47.98.102.138:4222 --description 'ComputeNest NATS Cluster' --select NATS Configuration Context \"computenest-nats\" Description: ComputeNest NATS Cluster Server URLs: nats://47.98.102.138:4222,nats://47.98.102.138:4222,nats://47.98.102.138:4222 Path: /root/.config/nats/context/computenest-nats.json Connection: OK $ nats context ls \u256d\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e \u2502 Known Contexts \u2502 \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524 \u2502 Name \u2502 Description \u2502 \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524 \u2502 computenest-nats* \u2502 ComputeNest NATS Cluster \u2502 \u2502 local \u2502 Local Host \u2502 \u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f \u63a5\u4e0b\u6765\u6240\u6709\u7684\u6b65\u9aa4\u90fd\u9ed8\u8ba4\u4f1a\u4f7f\u7528\u4e0a\u9762\u914d\u7f6e\u7684\u8ba1\u7b97\u5de2 NATS \u96c6\u7fa4.","title":"\u521b\u5efacontext"},{"location":"#_9","text":"$ nats stream add my_stream ? Subjects foo ? Storage file ? Replication 3 ? Retention Policy Limits ? Discard Policy Old ? Stream Messages Limit -1 ? Per Subject Messages Limit -1 ? Total Stream Size -1 ? Message TTL -1 ? Max Message Size -1 ? Duplicate tracking time window 2m0s ? Allow message Roll-ups No ? Allow message deletion Yes ? Allow purging subjects or the entire stream Yes Stream my_stream was created Information for Stream my_stream created 2023-04-09 08:28:33 Subjects: foo Replicas: 3 Storage: File Options: Retention: Limits Acknowledgements: true Discard Policy: Old Duplicate Window: 2m0s Allows Msg Delete: true Allows Purge: true Allows Rollups: false Limits: Maximum Messages: unlimited Maximum Per Subject: unlimited Maximum Bytes: unlimited Maximum Age: unlimited Maximum Message Size: unlimited Maximum Consumers: unlimited Cluster Information: Name: C1 Leader: iZbp139ju1kmizva7adgdcZ-172-16-0-157 Replica: iZbp139ju1kmizva7adgdbZ-172-16-0-155, current, seen 0.00s ago Replica: iZbp139ju1kmizva7adgddZ-172-16-0-156, current, seen 0.00s ago State: Messages: 0 Bytes: 0 B FirstSeq: 0 LastSeq: 0 Active Consumers: 0 \u6ce8\u610f\u4e8b\u9879\uff1a Replication \u914d\u7f6e\u4e3a3\uff0c\u6307\u660e\u521b\u5efa\u7684\u6d41\u5177\u5907\u4e09\u4e2a\u526f\u672c\u7684\u9ad8\u53ef\u7528\u7248\u672c\uff0cNATS \u4f1a\u57fa\u4e8eRAFT\u534f\u8bae\u8fdb\u884c\u6570\u636e\u5907\u4efd\u5b9e\u73b0\u9ad8\u53ef\u7528","title":"\u521b\u5efa\u6d41"},{"location":"#_10","text":"\u672c\u90e8\u5206\u4f7f\u7528 nats pub \u547d\u4ee4\u8fdb\u884c\u53d1\u5e03\u6d88\u606f $ nats pub foo --count=1000 --sleep 1s \"publication #{{Count}} @ {{TimeStamp}}\" 27 / 1000 [====>--------------------------------------------] 26","title":"\u53d1\u5e03\u6d88\u606f"},{"location":"#_11","text":"\u8981\u6d88\u8d39\u6d88\u606f\uff0c\u9996\u5148\u8981\u521b\u5efa\u6d88\u8d39\u8005\uff1a $ nats consumer add ? Consumer name foo_consumer ? Delivery target (empty for Pull Consumers) ? Start policy (all, new, last, subject, 1h, msg sequence) all ? Acknowledgement policy explicit ? Replay policy instant ? Filter Stream by subject (blank for all) ? Maximum Allowed Deliveries -1 ? Maximum Acknowledgements Pending 0 ? Deliver headers only without bodies No ? Add a Retry Backoff Policy No ? Select a Stream my_stream Information for Consumer my_stream > foo_consumer created 2023-04-09T08:31:23+08:00 Configuration: Durable Name: foo_consumer Pull Mode: true Deliver Policy: All Ack Policy: Explicit Ack Wait: 30s Replay Policy: Instant Max Ack Pending: 1,000 Max Waiting Pulls: 512 Cluster Information: Name: C1 Leader: iZbp139ju1kmizva7adgddZ-172-16-0-156 Replica: iZbp139ju1kmizva7adgdbZ-172-16-0-155, current, not seen Replica: iZbp139ju1kmizva7adgdcZ-172-16-0-157, current, seen 0.00s ago State: Last Delivered Message: Consumer sequence: 0 Stream sequence: 0 Acknowledgment floor: Consumer sequence: 0 Stream sequence: 0 Outstanding Acks: 0 out of maximum 1,000 Redelivered Messages: 0 Unprocessed Messages: 45 Waiting Pulls: 0 of maximum 512","title":"\u521b\u5efa\u6d88\u8d39\u8005"},{"location":"#_12","text":"\u521b\u5efa\u5b8c\u6d88\u8d39\u8005\u540e\u5c31\u53ef\u4ee5\u8fdb\u884c\u6d88\u8d39\u6570\u636e\uff1a $ nats consumer next my_stream foo_consumer --count 1000 [09:05:18] subj: foo / tries: 1 / cons seq: 1 / str seq: 1 / pending: 27 publication #1 @ 2023-04-06T15:17:18+08:00 Acknowledged message [09:05:18] subj: foo / tries: 1 / cons seq: 2 / str seq: 2 / pending: 26 publication #2 @ 2023-04-06T15:17:19+08:00 Acknowledged message [09:05:18] subj: foo / tries: 1 / cons seq: 3 / str seq: 3 / pending: 25 ...","title":"\u6d88\u8d39\u6d88\u606f"},{"location":"#_13","text":"\u591a\u5b9e\u4f8b\u6d88\u8d39\u6f14\u793a\u591a\u4e2a\u5b9e\u4f8b\u540c\u65f6\u6d88\u8d39\u4e00\u4e2atopic\u65f6\uff0cNATS \u4f1a\u8fdb\u884c\u4e00\u5b9a\u7684\u8d1f\u8f7d\u5747\u8861\u4fdd\u8bc1\u6bcf\u4e2a\u542f\u52a8\u7684\u5b9e\u4f8b\u5747\u5206\u751f\u4ea7\u7684\u6d88\u606f\uff0c\u8fd9\u5728\u5b9e\u9645\u4e1a\u52a1\u4e2d\u53ef\u4ee5\u505a\u8d1f\u8f7d\u5747\u8861\uff0c\u6d88\u8d39\u8005\u6c34\u5e73\u6269\u5c55\u3002 \u6d88\u8d39\u5b9e\u4f8b1: $ nats consumer next my_stream foo_consumer --count 1000 ... [08:33:45] subj: foo / tries: 1 / cons seq: 186 / str seq: 186 / pending: 0 publication #186 @ 2023-04-09T08:33:45+08:00 Acknowledged message [08:33:47] subj: foo / tries: 1 / cons seq: 188 / str seq: 188 / pending: 0 publication #188 @ 2023-04-09T08:33:47+08:00 Acknowledged message [08:33:49] subj: foo / tries: 1 / cons seq: 190 / str seq: 190 / pending: 0 publication #190 @ 2023-04-09T08:33:49+08:00 Acknowledged message [08:33:51] subj: foo / tries: 1 / cons seq: 192 / str seq: 192 / pending: 0 publication #192 @ 2023-04-09T08:33:51+08:00 Acknowledged message ... \u6d88\u8d39\u5b9e\u4f8b2: $ nats consumer next my_stream foo_consumer --count 1000 [08:33:46] subj: foo / tries: 1 / cons seq: 187 / str seq: 187 / pending: 0 publication #187 @ 2023-04-09T08:33:46+08:00 Acknowledged message [08:33:48] subj: foo / tries: 1 / cons seq: 189 / str seq: 189 / pending: 0 publication #189 @ 2023-04-09T08:33:48+08:00 Acknowledged message [08:33:50] subj: foo / tries: 1 / cons seq: 191 / str seq: 191 / pending: 0 publication #191 @ 2023-04-09T08:33:50+08:00 Acknowledged message [08:33:52] subj: foo / tries: 1 / cons seq: 193 / str seq: 193 / pending: 0 publication #193 @ 2023-04-09T08:33:52+08:00 Acknowledged message","title":"\u591a\u5b9e\u4f8b\u6d88\u8d39"},{"location":"#_14","text":"$ nats stream info my_stream nats stream info my_stream Information for Stream my_stream created 2023-04-09 08:28:33 Subjects: foo Replicas: 3 Storage: File Options: Retention: Limits Acknowledgements: true Discard Policy: Old Duplicate Window: 2m0s Allows Msg Delete: true Allows Purge: true Allows Rollups: false Limits: Maximum Messages: unlimited Maximum Per Subject: unlimited Maximum Bytes: unlimited Maximum Age: unlimited Maximum Message Size: unlimited Maximum Consumers: unlimited Cluster Information: Name: C1 Leader: iZbp139ju1kmizva7adgdcZ-172-16-0-157 Replica: iZbp139ju1kmizva7adgdbZ-172-16-0-155, current, seen 0.85s ago Replica: iZbp139ju1kmizva7adgddZ-172-16-0-156, current, seen 0.85s ago State: Messages: 350 Bytes: 26 KiB FirstSeq: 1 @ 2023-04-09T00:30:38 UTC LastSeq: 350 @ 2023-04-09T00:36:30 UTC Active Consumers: 1 Number of Subjects: 1 \u8bf4\u660e\uff1a \u53ef\u4ee5\u770b\u5230\u6d41\u7684\u526f\u672c\u6570\u4e3a3 \u96c6\u7fa4\u4fe1\u606f\u90e8\u5206\u53ef\u4ee5\u770b\u5230node2-c1 \u8fd9\u4e2a\u8282\u70b9\u662fLeader\uff0cnode1\u3001node3\u662fFollower \u4e0b\u4e00\u6b65\u5c06node2\u8282\u70b9\u5b95\u673a\u89c2\u770b\u6d41\u7684\u60c5\u51b5\u3002","title":"\u67e5\u770b\u6d41\u72b6\u6001"},{"location":"#_15","text":"\u901a\u8fc7\u67e5\u770b\u6d41\u7684\u72b6\u6001\u53d1\u73b0\u521b\u5efa\u7684\u6d41\u7684leader\u8282\u70b9\u662f\"iZbp139ju1kmizva7adgdcZ-172-16-0-157\"\uff0c \u73b0\u5728\u5c06\u6b64\u8282\u70b9\u5173\u673a: \u4e4b\u540e\u518d\u67e5\u770b\u6d41\u7684\u72b6\u6001 $ nats stream info my_stream Information for Stream my_stream created 2023-04-09 08:28:33 Subjects: foo Replicas: 3 Storage: File Options: Retention: Limits Acknowledgements: true Discard Policy: Old Duplicate Window: 2m0s Allows Msg Delete: true Allows Purge: true Allows Rollups: false Limits: Maximum Messages: unlimited Maximum Per Subject: unlimited Maximum Bytes: unlimited Maximum Age: unlimited Maximum Message Size: unlimited Maximum Consumers: unlimited Cluster Information: Name: C1 Leader: iZbp139ju1kmizva7adgddZ-172-16-0-156 Replica: iZbp139ju1kmizva7adgdbZ-172-16-0-155, current, seen 0.38s ago Replica: iZbp139ju1kmizva7adgdcZ-172-16-0-157, outdated, OFFLINE, seen 20.64s ago, 548 operations behind State: Messages: 545 Bytes: 41 KiB FirstSeq: 1 @ 2023-04-09T00:30:38 UTC LastSeq: 545 @ 2023-04-09T00:39:46 UTC Active Consumers: 1 Number of Subjects: 1 \u53ef\u4ee5\u770b\u5230\u96c6\u7fa4\u72b6\u6001\u90e8\u5206 156\u53f7\u8282\u70b9\u53d8\u6210\u65b0\u7684Leader\uff0c157\u72b6\u6001\u4e3aOFFLINE\u3002 \u6b64\u65f6\u521b\u5efa\u65b0\u7684\u6d88\u8d39\u8005\u91cd\u65b0\u6d88\u8d39\u6570\u636e\uff1a nats consumer add ? Consumer name foo_consumer2 ? Delivery target (empty for Pull Consumers) ? Start policy (all, new, last, subject, 1h, msg sequence) all ? Acknowledgement policy explicit ? Replay policy instant ? Filter Stream by subject (blank for all) ? Maximum Allowed Deliveries -1 ? Maximum Acknowledgements Pending 0 ? Deliver headers only without bodies No ? Add a Retry Backoff Policy No ? Select a Stream my_stream Information for Consumer my_stream > foo_consumer2 created 2023-04-09T08:42:07+08:00 Configuration: Durable Name: foo_consumer2 Pull Mode: true Deliver Policy: All Ack Policy: Explicit Ack Wait: 30s Replay Policy: Instant Max Ack Pending: 1,000 Max Waiting Pulls: 512 Cluster Information: Name: C1 Leader: iZbp139ju1kmizva7adgdbZ-172-16-0-155 Replica: iZbp139ju1kmizva7adgdcZ-172-16-0-157, outdated, not seen Replica: iZbp139ju1kmizva7adgddZ-172-16-0-156, current, seen 0.00s ago State: Last Delivered Message: Consumer sequence: 0 Stream sequence: 0 Acknowledgment floor: Consumer sequence: 0 Stream sequence: 0 Outstanding Acks: 0 out of maximum 1,000 Redelivered Messages: 0 Unprocessed Messages: 685 Waiting Pulls: 0 of maximum 512 $ nats consumer next my_stream foo_consumer2 --count 3 [08:42:27] subj: foo / tries: 1 / cons seq: 1 / str seq: 1 / pending: 703 publication #1 @ 2023-04-09T08:30:38+08:00 Acknowledged message [08:42:27] subj: foo / tries: 1 / cons seq: 2 / str seq: 2 / pending: 702 publication #2 @ 2023-04-09T08:30:39+08:00 Acknowledged message [08:42:27] subj: foo / tries: 1 / cons seq: 3 / str seq: 3 / pending: 701 publication #3 @ 2023-04-09T08:30:40+08:00 Acknowledged message \u6b64\u65f6\u6545\u969c\u8282\u70b9\u6062\u590d\u4e4b\u540e\uff1a\u91cd\u65b0\u67e5\u770b\u6d41\u7684\u72b6\u6001\uff1a $ nats stream info my_stream Information for Stream my_stream created 2023-04-09 08:28:33 Subjects: foo Replicas: 3 Storage: File Options: Retention: Limits Acknowledgements: true Discard Policy: Old Duplicate Window: 2m0s Allows Msg Delete: true Allows Purge: true Allows Rollups: false Limits: Maximum Messages: unlimited Maximum Per Subject: unlimited Maximum Bytes: unlimited Maximum Age: unlimited Maximum Message Size: unlimited Maximum Consumers: unlimited Cluster Information: Name: C1 Leader: iZbp139ju1kmizva7adgddZ-172-16-0-156 Replica: iZbp139ju1kmizva7adgdbZ-172-16-0-155, current, seen 0.22s ago Replica: iZbp139ju1kmizva7adgdcZ-172-16-0-157, current, seen 0.22s ago State: Messages: 780 Bytes: 58 KiB FirstSeq: 1 @ 2023-04-09T00:30:38 UTC LastSeq: 780 @ 2023-04-09T00:43:43 UTC Active Consumers: 2 Number of Subjects: 1 \u53ef\u4ee5\u770b\u5230\u6d41\u7684\u96c6\u7fa4\u4fe1\u606f\u4e09\u4e2a\u8282\u70b9\u5168\u90e8\u53d8\u4e3a\u53ef\u7528\u72b6\u6001\uff0c\u521a\u5f02\u5e38\u7684node2\u8282\u70b9\u6062\u590d\u4e86,\u52a0\u5165\u4e4b\u524d\u4e24\u4e2a\u5065\u5eb7\u8282\u70b9\u7684\u96c6\u7fa4\u540e\u81ea\u52a8\u53d8\u6210\u4e86follower\u3002","title":"\u9ad8\u53ef\u7528\u9a8c\u8bc1"},{"location":"#_16","text":"NATS \u76ee\u524d\u9010\u6b65\u6f14\u53d8\u4e3a\u4e00\u4e2a\u751f\u6001\uff0c\u53ef\u4ee5\u5b9e\u8df5\u3001\u6f14\u793a\u7684\u529f\u80fd\u8fd8\u975e\u5e38\u591a\uff0c\u5305\u62ec\u5355\u4e0d\u9650\u4e8e\u4ee5\u4e0b\u65b9\u9762\uff1a \u5b89\u5168\u8ba4\u8bc1 \uff1a\u652f\u6301Token\u3001user/pass\u3001TLS\u3001NKEY\u3001JWT\u7b49\u5b89\u5168\u914d\u7f6e \u8fde\u63a5\u534f\u8bae \uff1a\u9664\u4e86\u57fa\u4e8e\u9ed8\u8ba4\u7684nats \u8fde\u63a5\u534f\u8bae\u5916\uff0c\u8fd8\u652f\u6301WebSocket\u3001MQTT\u8fde\u63a5\uff0c\u5e76\u4e14\u53ef\u4ee5\u901a\u8fc7Kafka Bridge JMS \u5c06\u5176\u4ed6\u6d88\u606f\u7cfb\u7edf\u7684\u6d41\u91cf\u8f6c\u5230NATS JetStream \u66f4\u591a\u7684\u529f\u80fd \uff1aJetStream \u662fNATS\u6700\u65b0\u4e00\u4ee3\u7684\u9ad8\u53ef\u7528\u6d41\u5f0f\u7cfb\u7edf\uff0c\u652f\u6301\u975e\u5e38\u591a\u7684\u9ad8\u7ea7\u7279\u6027\uff1a \u6d41\u91cd\u653e\u7b56\u7565 \u6d41\u5f0f\u5b58\u50a8 \u4fdd\u7559\u7b56\u7565 \u6d88\u606f\u914d\u989d \u6301\u4e45\u5316 \u6d41Mirror \u53cc\u7aef\u6d41\u63a7 Exactly-Once\u8bed\u4e49\u652f\u6301 \u591a\u79df\u6237\u7ba1\u7406 \uff1a\u57fa\u4e8e nsc \u5de5\u5177\u8fdb\u884c\u591a\u79df\u6237\u8d26\u53f7\u914d\u7f6e\u7ba1\u7406 \u8fb9\u7f18\u573a\u666f \uff1a\u4e3a\u4e86\u652f\u6301\u8fb9\u7f18\u8ba1\u7b97\u3001IOT\u573a\u666f\uff0cNATS\u652f\u6301\u5728\u8fb9\u7f18\u90e8\u7f72\u672c\u5730\u7684NATS\u96c6\u7fa4\uff0c\u8ddf\u4e2d\u5fc3\u96c6\u7fa4\u4ea4\u4e92\u3002\u4f7f\u5f97\u8fb9\u7f18\u8bbe\u5907\u53ef\u4ee5\u901a\u8fc7\u8fde\u63a5\u8fb9\u7f18\u672c\u5730\u96c6\u7fa4\u5feb\u901f\u8fdb\u884c\u4e1a\u52a1\u6570\u636e\u7684\u751f\u4ea7\uff0c\u4e0d\u4f1a\u5f3a\u4f9d\u8d56\u8ddf\u8fdc\u7aef\u4e2d\u5fc3\u96c6\u7fa4\u7684\u7f51\u7edc\u7a33\u5b9a\u6027\uff0c\u8fb9\u7f18\u573a\u666f \u53c2\u8003 \u3002","title":"\u4e0b\u4e00\u6b65"},{"location":"#_17","text":"[1]: nats cluster creation: https://docs.nats.io/running-a-nats-service/nats_docker#creating-a-nats-cluster [2]: jetString cluster: https://docs.nats.io/running-a-nats-service/configuration/clustering/jetstream_clustering [3]: js walkthrough\uff1a https://docs.nats.io/nats-concepts/jetstream/js_walkthrough [4]: \u57fa\u4e8eNATS JetStream\u6784\u5efa\u5206\u5e03\u5f0f\u4e8b\u4ef6\u6d41\u7cfb\u7edf","title":"\u53c2\u8003\u6587\u6863"}]}